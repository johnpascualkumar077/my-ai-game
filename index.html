<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<div id="game-container">
    <h1>AI MINER</h1>
    <div id="balance">₿ 0.00000000</div>
    
    <button class="btn" onclick="manualMine()">MANUAL MINE</button>
    
    <div class="upgrade-section">
        <button id="upgradeBtn" class="btn" onclick="buyAgent()">HIRE AI AGENT</button>
        <div id="agentCount" class="status">AI Agents: 0</div>
    </div>

    <div class="upgrade-section">
        <h3>GLOBAL RANKING</h3>
        <div id="ranking-list" style="font-size: 0.8rem; color: var(--neon-blue);">Loading...</div>
        <button class="btn" style="font-size: 0.8rem;" onclick="submitScore()">SUBMIT SCORE</button>
    </div>

    <div class="upgrade-section">
        <button class="btn" style="border-color: #f2a900; color: #f2a900;" onclick="openDonation()">💰 TIP THE DEVELOPER</button>
        <p style="font-size: 0.6rem; color: #666;">面白かったらコーヒー代を奢ってくれ</p>
    </div>
</div>

<script>
    // --- Supabase設定 (ここを自分のキーに書き換えろ) ---
    const SUPABASE_URL = 'https://wrfkcxacdrhjydqvjvgw.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndyZmtjeGFjZHJoanlkcXZqdmd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MjUwMTMsImV4cCI6MjA4NzAwMTAxM30.-1OF-Kx7f-4qMF2MMIpGXeqKGQye73ja3iyafrimOuI'; 
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- ランキング機能 ---
    async function submitScore() {
        const playerName = prompt("ランキングに載せる名前は？") || "Anonymous";
        const { data, error } = await supabase
            .from('rankings')
            .insert([{ player_name: playerName, score: balance }]);
        
        if (error) console.error(error);
        else {
            alert("スコア送信完了！");
            fetchRankings();
        }
    }

    async function fetchRankings() {
        const { data, error } = await supabase
            .from('rankings')
            .select('*')
            .order('score', { ascending: false })
            .limit(5);
        
        if (data) {
            const list = data.map((r, i) => `${i+1}. ${r.player_name}: ₿${r.score.toFixed(8)}`).join('<br>');
            document.getElementById('ranking-list').innerHTML = list;
        }
    }
    // 初回読み込み
    fetchRankings();

    // --- ドネーション機能 ---
    function openDonation() {
        // 合理的な選択：StripeのPayment Linkか、Buy Me a CoffeeのURLをここに貼る
        // とりあえず今はデモとしてGoogleのトップに飛ばすが、自分のリンクに書き換えろ
        window.open('https://www.buymeacoffee.com/YOUR_NAME', '_blank');
    }

    // (既存のゲームロジックはそのまま維持...)
</script>
